#!/bin/bash
set -e
# Ð¦Ð²ÐµÑ‚Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° root
if [[ $EUID -ne 0 ]]; then
   echo -e "${RED}Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¾Ñ‚ root.${NC}"
   exit 1
fi
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ swap Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸
create_swap_if_needed() {
    TOTAL_MEM_KB=$(grep MemTotal /proc/meminfo | awk '{print $2}')
    TOTAL_MEM_GB=$((TOTAL_MEM_KB / 1024 / 1024))
    if [ "$TOTAL_MEM_GB" -le 1 ]; then
        if ! swapon --show | grep -q '/swapfile'; then
            echo -e "${GREEN}Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ swap-Ñ„Ð°Ð¹Ð»Ð° 2 Ð“Ð‘ (RAM â‰¤ 1 Ð“Ð‘)...${NC}"
            fallocate -l 2G /swapfile || dd if=/dev/zero of=/swapfile bs=1M count=2048
            chmod 600 /swapfile
            mkswap /swapfile
            swapon /swapfile
            echo '/swapfile none swap sw 0 0' >> /etc/fstab
            echo 'vm.swappiness=10' >> /etc/sysctl.conf
            echo 'vm.vfs_cache_pressure=50' >> /etc/sysctl.conf
            sysctl -p >/dev/null 2>&1
            echo -e "${GREEN}Swap ÑÐ¾Ð·Ð´Ð°Ð½.${NC}"
        fi
    fi
}
create_swap_if_needed
# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo -e "${GREEN}ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹...${NC}"
apt update && apt upgrade -y
apt install -y curl wget gnupg net-tools qrencode jq
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ„Ð°ÐµÑ€Ð²Ð¾Ð»Ð° (ufw + fail2ban) â€” ÐºÐ°Ðº Ð¾Ð±ÐµÑ‰Ð°Ð½Ð¾ Ð² README
echo -e "${GREEN}ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ufw Ð¸ fail2ban...${NC}"
apt install -y ufw fail2ban
ufw allow 443/tcp
ufw --force enable
systemctl enable --now fail2ban
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Xray
echo -e "${GREEN}Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Xray-core...${NC}"
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ xray ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
if ! command -v xray &> /dev/null; then
    echo -e "${RED}ÐžÑˆÐ¸Ð±ÐºÐ°: xray Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¸Ð»Ð¸ Ð½Ðµ Ð² PATH.${NC}"
    exit 1
fi
if ! xray version &> /dev/null; then
    echo -e "${RED}ÐžÑˆÐ¸Ð±ÐºÐ°: xray ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, Ð½Ð¾ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ.${NC}"
    exit 1
fi
# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ IP (Ñ fallback Ð½Ð° IPv6)
IP=$(curl -4 -s icanhazip.com || curl -6 -s icanhazip.com)
if [[ -z "$IP" ]]; then
    echo -e "${RED}ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ IP. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ.${NC}"
    exit 1
fi
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð½ÑÑ‚Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ñ€Ñ‚Ð° 443 (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
if ss -tuln | grep -q ':443 '; then
    echo -e "${RED}ÐŸÐ¾Ñ€Ñ‚ 443 ÑƒÐ¶Ðµ Ð·Ð°Ð½ÑÑ‚! ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ nginx, apache Ð¸Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÑÐµÑ€Ð²Ð¸Ñ.${NC}"
    exit 1
fi
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ UUID Ð¸ ÐºÐ»ÑŽÑ‡ÐµÐ¹ (ÐžÐ”Ð˜Ð Ñ€Ð°Ð·!)
UUID=$(xray uuid)
KEYPAIR=$(xray x25519)
REALITY_PRIV_KEY=$(echo "$KEYPAIR" | awk '/^PrivateKey:/ {print $2}')
REALITY_PUB_KEY=$(echo "$KEYPAIR" | awk '/^Password:/ {print $2}')
SHORT_ID=$(openssl rand -hex 4)
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ¹
mkdir -p /usr/local/etc/xray
cat > /usr/local/etc/xray/.keys <<EOF
uuid: $UUID
Private key: $REALITY_PRIV_KEY
Password: $REALITY_PUB_KEY
shortsid: $SHORT_ID
EOF
# ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ DoH Cloudflare Ð¸ Ð¼Ð°ÑÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹ Ð¿Ð¾Ð´ www.cloudflare.com
cat > /usr/local/etc/xray/config.json <<EOF
{
  "log": {
    "loglevel": "warning"
  },
  "dns": {
    "servers": [
      "https://1.1.1.1/dns-query"
    ],
    "tag": "doh-cloudflare"
  },
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "id": "$UUID",
            "email": "main",
            "flow": "xtls-rprx-vision"
          }
        ],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "show": false,
          "dest": "www.cloudflare.com:443",
          "xver": 0,
          "serverNames": ["www.cloudflare.com"],
          "privateKey": "$REALITY_PRIV_KEY",
          "shortIds": ["$SHORT_ID"]
        }
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "freedom",
      "settings": {},
      "tag": "direct",
      "streamSettings": {
        "sockopt": {
          "tcpKeepAliveIdle": 100,
          "tcpNoDelay": true
        }
      },
      "dnsSettings": {
        "server": "https://1.1.1.1/dns-query"
      }
    },
    {
      "protocol": "dns",
      "tag": "dns-out"
    }
  ],
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      {
        "type": "field",
        "port": "53",
        "outboundTag": "dns-out"
      }
    ]
  }
}
EOF
# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐ»ÑƒÐ¶Ð±Ñ‹
systemctl daemon-reload
systemctl enable --now xray
# Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹
cat > /usr/local/bin/listuser <<'EOF'
#!/bin/bash
emails=($(jq -r '.inbounds[0].settings.clients[].email' "/usr/local/etc/xray/config.json"))
if [[ ${#emails[@]} -eq 0 ]]; then
    echo "Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¿ÑƒÑÑ‚"
    exit 1
fi
echo "Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²:"
for i in "${!emails[@]}"; do
    echo "$((i+1)). ${emails[$i]}"
done
EOF
chmod +x /usr/local/bin/listuser

cat > /usr/local/bin/adduser <<'EOF'
#!/bin/bash
read -p "Ð˜Ð¼Ñ: " email
if [[ -z "$email" || "$email" == *" "* ]]; then echo "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ email"; exit 1; fi
if jq -e --arg e "$email" '.inbounds[0].settings.clients[] | select(.email == $e)' /usr/local/etc/xray/config.json >/dev/null; then
    echo "Ð£Ð¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"; exit 1
fi
uuid=$(xray uuid)
jq --arg e "$email" --arg u "$uuid" '.inbounds[0].settings.clients += [{"email": $e, "id": $u, "flow": "xtls-rprx-vision"}]' /usr/local/etc/xray/config.json > /tmp/x.json && mv /tmp/x.json /usr/local/etc/xray/config.json
systemctl restart xray
protocol=$(jq -r '.inbounds[0].protocol' /usr/local/etc/xray/config.json)
port=$(jq -r '.inbounds[0].port' /usr/local/etc/xray/config.json)
pbk=$(awk -F': ' '/Password/ {print $2}' /usr/local/etc/xray/.keys)
sid=$(awk -F': ' '/shortsid/ {print $2}' /usr/local/etc/xray/.keys)
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' /usr/local/etc/xray/config.json)
ip=$(curl -4 -s icanhazip.com)
link="$protocol://$uuid@$ip:$port?security=reality&sni=$sni&fp=firefox&pbk=$pbk&sid=$sid&type=tcp&flow=xtls-rprx-vision&encryption=none#$email"
echo
echo "Ð¡ÑÑ‹Ð»ÐºÐ°:"
echo "$link"
echo
echo "QR:"
echo "$link" | qrencode -t ansiutf8 -s 2
EOF
chmod +x /usr/local/bin/adduser

cat > /usr/local/bin/rmuser <<'EOF'
#!/bin/bash
emails=($(jq -r '.inbounds[0].settings.clients[].email' "/usr/local/etc/xray/config.json"))
if [[ ${#emails[@]} -eq 0 ]]; then echo "ÐÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²"; exit 1; fi
for i in "${!emails[@]}"; do echo "$((i+1)). ${emails[$i]}"; done
read -p "ÐÐ¾Ð¼ÐµÑ€: " n
if ! [[ "$n" =~ ^[0-9]+$ ]] || (( n < 1 || n > ${#emails[@]} )); then echo "ÐžÑˆÐ¸Ð±ÐºÐ°"; exit 1; fi
e="${emails[$((n-1))]}"
jq --arg e "$e" '(.inbounds[0].settings.clients) |= map(select(.email != $e))' /usr/local/etc/xray/config.json > /tmp/x.json && mv /tmp/x.json /usr/local/etc/xray/config.json
systemctl restart xray
echo "Ð£Ð´Ð°Ð»Ñ‘Ð½: $e"
EOF
chmod +x /usr/local/bin/rmuser

cat > /usr/local/bin/sharelink <<'EOF'
#!/bin/bash
emails=($(jq -r '.inbounds[0].settings.clients[].email' "/usr/local/etc/xray/config.json"))
if [[ ${#emails[@]} -eq 0 ]]; then echo "ÐÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²"; exit 1; fi
for i in "${!emails[@]}"; do echo "$((i+1)). ${emails[$i]}"; done
read -p "Ð’Ñ‹Ð±Ð¾Ñ€: " n
if ! [[ "$n" =~ ^[0-9]+$ ]] || (( n < 1 || n > ${#emails[@]} )); then echo "ÐžÑˆÐ¸Ð±ÐºÐ°"; exit 1; fi
email="${emails[$((n-1))]}"
uuid=$(jq --arg e "$email" 'first(.inbounds[0].settings.clients[] | select(.email == $e) | .id)' /usr/local/etc/xray/config.json)
protocol=$(jq -r '.inbounds[0].protocol' /usr/local/etc/xray/config.json)
port=$(jq -r '.inbounds[0].port' /usr/local/etc/xray/config.json)
pbk=$(awk -F': ' '/Password/ {print $2}' /usr/local/etc/xray/.keys)
sid=$(awk -F': ' '/shortsid/ {print $2}' /usr/local/etc/xray/.keys)
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' /usr/local/etc/xray/config.json)
ip=$(curl -4 -s icanhazip.com)
link="$protocol://$uuid@$ip:$port?security=reality&sni=$sni&fp=firefox&pbk=$pbk&sid=$sid&type=tcp&flow=xtls-rprx-vision&encryption=none#$email"
echo
echo "Ð¡ÑÑ‹Ð»ÐºÐ°:"
echo "$link"
echo
echo "QR:"
echo "$link" | qrencode -t ansiutf8 -s 2
EOF
chmod +x /usr/local/bin/sharelink

cat > /usr/local/bin/update <<'EOF'
#!/bin/bash
echo "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Xray..."
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install
systemctl restart xray
echo "Ð“Ð¾Ñ‚Ð¾Ð²Ð¾."
EOF
chmod +x /usr/local/bin/update

# === ÐÐžÐ’ÐÐ¯ ÐšÐžÐœÐÐÐ”Ð: openssh ===
cat > /usr/local/bin/openssh <<'EOF'
#!/bin/bash
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${YELLOW}ðŸ”’ ÐŸÐ¾Ñ€Ñ‚ 22 Ð·Ð°ÐºÑ€Ñ‹Ñ‚ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸.${NC}"
echo
echo -e "${YELLOW}âš ï¸  Ð’ÐÐ–ÐÐž: Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð²Ð°Ñˆ Ð’ÐÐ•Ð¨ÐÐ˜Ð™ (Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹) IPv4-Ð°Ð´Ñ€ÐµÑ!${NC}"
echo -e "   Ð­Ñ‚Ð¾ ÐÐ• Ð°Ð´Ñ€ÐµÑ Ð²Ð¸Ð´Ð° 192.168.x.x, 10.x.x.x Ð¸Ð»Ð¸ IP Ð²Ð°ÑˆÐµÐ³Ð¾ VPS."
echo
echo -e "   Ð£Ð·Ð½Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¼ Ð¸Ð· ÑÐ°Ð¹Ñ‚Ð¾Ð²:"
echo -e "     â€¢ https://myip.ru/"
echo -e "     â€¢ https://2ip.ru/"
echo -e "     â€¢ https://www.dnsleaktest.com/"
echo
read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP-Ð°Ð´Ñ€ÐµÑ: " USER_IP

# ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð½Ð¾ÑÑ‚Ð¸ IPv4
if [[ ! "$USER_IP" =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]; then
    echo -e "${RED}âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ IP-Ð°Ð´Ñ€ÐµÑÐ°.${NC}"
    exit 1
fi

# Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°: ÐºÐ°Ð¶Ð´Ð°Ñ Ñ‡Ð°ÑÑ‚ÑŒ â‰¤ 255
IFS='.' read -r a b c d <<< "$USER_IP"
if (( a > 255 || b > 255 || c > 255 || d > 255 )); then
    echo -e "${RED}âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ IP-Ð°Ð´Ñ€ÐµÑ (Ñ‡Ð¸ÑÐ»Ð° Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ â‰¤ 255).${NC}"
    exit 1
fi

# ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ, ÐµÑÐ»Ð¸ IP Ð¿Ð¾Ñ…Ð¾Ð¶ Ð½Ð° Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹
if [[ "$USER_IP" =~ ^(192\.168|10\.|172\.(1[6-9]|2[0-9]|3[01])) ]]; then
    echo -e "${RED}âš ï¸  Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ: Ð²Ñ‹ Ð²Ð²ÐµÐ»Ð¸ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ (Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹) IP-Ð°Ð´Ñ€ÐµÑ!${NC}"
    echo -e "${RED}   Ð¢Ð°ÐºÐ¾Ð¹ Ð°Ð´Ñ€ÐµÑ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¸Ð· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP Ñ myip.ru.${NC}"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼, Ð½Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð»Ð¸ ÑƒÐ¶Ðµ ÑÑ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¾
if ufw status | grep -q "ALLOW IN.*$USER_IP.*22"; then
    echo -e "${GREEN}âœ… ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ Ð´Ð»Ñ $USER_IP ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚.${NC}"
else
    echo -e "${GREEN}ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ SSH Ð´Ð»Ñ $USER_IP...${NC}"
    ufw allow from "$USER_IP" to any port 22
    echo -e "${GREEN}âœ… Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð¿Ð¾ SSH Ñ€Ð°Ð·Ñ€ÐµÑˆÑ‘Ð½ Ñ $USER_IP.${NC}"
fi
EOF
chmod +x /usr/local/bin/openssh

# Ð¤Ð°Ð¹Ð» help
cat > $HOME/help <<'EOF'
Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:
  listuser    â€” ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²
  adduser     â€” ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  rmuser      â€” ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  sharelink   â€” Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  update      â€” Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ´Ñ€Ð¾
  openssh     â€” Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ SSH Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ IP
EOF

# Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´
clear
echo
echo -e "${GREEN}âœ… Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Xray (REALITY + Vision) Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!${NC}"
echo

# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÑÑ‹Ð»ÐºÐ¸ Ð´Ð»Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ "main"
MAIN_UUID=$(jq -r '.inbounds[0].settings.clients[0].id' /usr/local/etc/xray/config.json)
pbk=$(awk -F': ' '/Password/ {print $2}' /usr/local/etc/xray/.keys)
sid=$(awk -F': ' '/shortsid/ {print $2}' /usr/local/etc/xray/.keys)
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' /usr/local/etc/xray/config.json)
ip=$(curl -4 -s icanhazip.com || curl -6 -s icanhazip.com)
if [[ -z "$ip" ]]; then
    echo -e "${RED}âš ï¸ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ IP Ð´Ð»Ñ ÑÑÑ‹Ð»ÐºÐ¸.${NC}"
else
    LINK="vless://$MAIN_UUID@$ip:443?security=reality&sni=$sni&fp=firefox&pbk=$pbk&sid=$sid&type=tcp&flow=xtls-rprx-vision&encryption=none#main"
    echo
    echo "Ð¡ÑÑ‹Ð»ÐºÐ° Ð´Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ:"
    echo
    echo "$LINK"
    echo
    echo "QR-ÐºÐ¾Ð´:"
    echo "$LINK" | qrencode -t ansiutf8 -s 2
fi
echo
echo -e "${GREEN} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ cat help Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´${NC}"

# ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾ SSH
echo
echo -e "${YELLOW}ðŸ”’ ÐŸÐ¾Ñ€Ñ‚ 22 (SSH) Ð·Ð°ÐºÑ€Ñ‹Ñ‚ Ñ„Ð°ÐµÑ€Ð²Ð¾Ð»Ð¾Ð¼. Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿, Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ:${NC}"
echo -e "${GREEN}       openssh${NC}"
echo -e "${YELLOW}   Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ myip.ru).${NC}"

echo -e "${YELLOW}ðŸ’¡ Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Â«Use Remote DNSÂ» Ð² ÐºÐ»Ð¸ÐµÐ½Ñ‚Ðµ (Hiddify) Ð¸ Ñ€ÐµÐ¶Ð¸Ð¼ VPN!${NC}"
